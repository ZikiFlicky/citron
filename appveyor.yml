#---------------------------------#
#      general configuration      #
#---------------------------------#

# version format
version: 0.0.8.6-{branch}-{build}

# you can use {branch} name in version format too
# version: 1.0.{build}-{branch}

# branches to build
branches:
  # whitelist
  only:
    - windows

# Do not build on tags (GitHub and BitBucket)
skip_tags: true

# Including commits with particular message or from specific user
only_commits:
  message: /build/                # Start a new build if message contains 'build'

# Maximum number of concurrent jobs for the project
max_jobs: 1

#---------------------------------#
#    environment configuration    #
#---------------------------------#

# Build worker image (VM template)
image: Visual Studio 2015

environment:
  matrix:
    - COMPILER: msys2
      PLATFORM: x86
      MSYS2_ARCH: x86
      MSYS2_DIR: msys64
      MSYSTEM: MINGW32

# scripts that are called at very beginning, before repo cloning
init:
  - git config --global core.autocrlf false

# clone directory
clone_folder: c:\projects\citron

# set clone depth
clone_depth: 5                      # clone entire repository history if not defined

# scripts that run after cloning repository
install:
  # by default, all script lines are interpreted as batch
  - echo Starting build here

#---------------------------------#
#       build configuration       #
#---------------------------------#

# build Configuration, i.e. Debug, Release, etc.
configuration: Release

# to add several configurations to build matrix:
#configuration:
#  - Debug
#  - Release

# to run your custom scripts instead of automatic MSBuild
build_script:
  - '%APPVEYOR_BUILD_FOLDER%\build_windows_package.bat'

# to disable automatic builds
build: on


#---------------------------------#
#      artifacts configuration    #
#---------------------------------#

artifacts:

  # pushing a single file
  - path: citron-release.tar


#---------------------------------#
#     deployment configuration    #
#---------------------------------#

# providers: Local, FTP, WebDeploy, AzureCS, AzureBlob, S3, NuGet, Environment
# provider names are case-sensitive!
deploy:
    # Deploy to GitHub Releases
  - provider: GitHub
    artifact: /\.tar/           # upload all NuGet packages to release assets
    draft: false
    prerelease: false
    on:
      branch: windows                # release from master branch only
      appveyor_repo_tag: true       # deploy on tag push only


#---------------------------------#
#         notifications           #
#---------------------------------#

notifications:

  # Email
  - provider: Email
    to:
      - ali.mpfard@gmail.com
    subject: 'Build {{status}}'                  # optional
    message: "{{message}}, {{commitId}}, ..."    # optional
    on_build_status_changed: true
