language: c
compiler: clang
before_install:
    - sudo apt-get -qq update
    - sudo apt-get install -y libffi-dev libbsd-dev libpcre3-dev realpath libcurl4-openssl-dev
    - ls
    - cd bdwgc
    - ./autogen.sh && ./configure && make -j && sudo make install
    - cd ..
install:
  - cd autohell && aclocal && libtoolize && autoconf && automake --add-missing
  - mkdir -p build && ./configure --prefix=$(realpath ./build) && make
  - cd .. && bash ./makeplugs.sh
  - cd autohell
  - make install
  - cd ..

script:
  - echo "bash ./runtests.sh autohell/build/bin" #Ignore tests for now

after_success:
  - wget https://github.com/probonopd/linuxdeployqt/releases/download/continuous/linuxdeployqt-continuous-x86_64.AppImage
  - chmod a+x linuxdeployqt-continuous-x86_64.AppImage
  - cd autohell/build/bin
  - ../../../linuxdeployqt-continuous-x86_64.AppImage ctr -bundle-non-qt-libs
  - cd ../../..
  - ls -lh autohell/build/*
  - tar cjf release.tar.bz2 -C autohell/build .
  - (cd autohell/build && zip -r - .) > release.zip
  - wget -c https://github.com/probonopd/uploadtool/raw/master/upload.sh
  - bash upload.sh release.tar.bz2 release.zip

branches:
  except:
    - # Do not build tags that we create when we upload to GitHub Releases
    - /^(?i:continuous)$/
